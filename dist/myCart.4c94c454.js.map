{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,0EAOA,IAAIC,EAAQ,EACRC,EAAO,GACX,MAAMC,EAAaC,SAASC,eAAe,gBACrCC,EAAiBF,SAASC,eAAe,6BACzCE,EAAeH,SAASC,eAAe,gBACvCG,EAAcJ,SAASC,eAAe,eAE5C,SAASI,EAASC,GAChBT,EAAQ,EACRS,EAAKC,SAAQC,cAmDFA,GAEX,MAAAC,EAAYT,SAAiBU,cAAc,QACvCC,UAAiB,uBACdC,UAAc,qCAGlBJ,EAAAK,OAAA,uDAGLL,EAAAM,uCACMN,EAAAO,iBAAAP,EAAaQ,iEAGfC,EAAWC,eAAEV,EAAAW,mQAMhBpB,EAAAqB,YAAAX,GAEDA,EAAMY,iBAAA,SAAcC,IACdA,EAAAC,iBACkB,QAApBD,EAAME,OAAKC,wBAnDLC,GAER,MAAAC,EAAA7B,EAAA8B,QAAApB,GAAiBA,EAASqB,KAAAH,IAE1B5B,EAAA6B,EAEAG,kBAAAC,EAAAC,mBAAkBrC,EAAAsC,GAAAH,WAAAI,IAAAP,GACnBQ,EAAAC,iBAAAT,GAED5B,EAASa,UAAe,GACtBV,EAA6BU,UAAoB,GACjDP,EAAwBsB,GAwCFU,CAAA7B,EAAAqB,OA1EpBS,CAAe9B,GACfX,GAAS0C,SAAS/B,EAAQW,UAG5B,MAAMqB,EAAYxC,SAASU,cAAc,OAEzC8B,EAAU5B,UAAY,2CAQtBK,EAAYC,eAAArB,oBAKZK,EAAgBkB,YAAWoB,GAAoCC,QAAEC,IAAAzB,EAAAC,eAAArB,UAuEjE8C,EAAWC,MAAYC,IACvB,IAGA,MAAMC,QAAWC,EAAAC,OAAAD,EAAAE,WAAAtD,EAAAsC,GAAA,UAAA,IACfY,EACAK,SAAEpD,EAjHNqD,MAkHItD,IAGCuD,MAAA,WAAAP,EAAI/B,kBAAOgC,EAAAjB,mBAtBTe,qBAGHG,EAAAM,UAAAN,EAAAO,IAAA3D,EAAAsC,GAAA,OAAAH,WAAAI,MACD7B,EAAQ,IACPoC,QAAQC,IAAI,kBACb,MAAApB,GACDmB,QAAAC,IAAApB,GAGAiC,OAAEC,SAAcC,UAadC,SAGEpC,WAGGoB,IAACpB,OAKID,iBAAA,SAAAC,6BAGRR,EAAAX,EAAaW,KAAA6C,MAEd9B,EACG1B,EAAO0B,GAAA8B,MAGXC,EAAAzD,EAASyD,OAAID,MAEZd,EAAA","sources":["logic/myCart.js"],"sourcesContent":["import { auth, db } from \"./importFirebase\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\nimport { getFirebaseCart, createFirebaseCart } from \"./cart\";\r\nimport { getMyCart, addProductToCart } from \"./productDetail\";\r\nimport { currencyFormat } from \"./utils/index\";\r\nimport { addDoc, collection, deleteDoc, doc } from \"firebase/firestore\";\r\n \r\nlet total = 0;\r\nlet cart = [];\r\nconst cartResume = document.getElementById(\"cart__resume\");\r\nconst cartPriceTotal = document.getElementById(\"cart__total__info__inside\");\r\nconst checkoutInfo = document.getElementById(\"checkoutInfo\");\r\nconst btnCheckout = document.getElementById(\"btnCheckout\");\r\n\r\nfunction loadCart(cart) {\r\n  total = 0;\r\n  cart.forEach(product => {\r\n    renderProducts(product);\r\n    total += parseInt(product.price);\r\n  });\r\n  \r\n  const cartTotal = document.createElement(\"div\");\r\n\r\n  cartTotal.innerHTML = `\r\n    <p>Total payment is:</p>\r\n    <h1>${currencyFormat(total)}</h1>\r\n    \r\n  `;\r\n\r\n  cartPriceTotal.appendChild(cartTotal);\r\n  \r\n  console.log(currencyFormat(total));\r\n  \r\n};\r\n\r\nasync function removeProducts(productId){\r\n  const newCart = cart.filter(product => product.id !== productId);\r\n  cart = newCart;\r\n\r\n  if(userLogged) {\r\n    await createFirebaseCart(db, userLogged.uid, newCart);\r\n  }\r\n  addProductToCart(newCart);\r\n  cartResume.innerHTML = \"\";\r\n  cartPriceTotal.innerHTML = \"\";\r\n  \r\n  loadCart(newCart);\r\n}\r\n\r\nfunction renderProducts(product) {\r\n  const productCart = document.createElement(\"li\");\r\n  productCart.className = \"cart__resume__list\";\r\n\r\n  productCart.innerHTML = `\r\n  <img class=\"product_img\" src=\"${product.images[0]}\" alt=\"producto\" width=\"165\">\r\n  <div>\r\n      <h3>${product.name}</h3>                \r\n      <p>${product.color} / size: ${product.size} </p>\r\n  </div>\r\n  <div>\r\n      <p class=\"product__price\">${currencyFormat(product.price)}</p>\r\n  </div>\r\n  <div>\r\n      <img class=\"img-remove\" src=\"https://firebasestorage.googleapis.com/v0/b/maog-shop.appspot.com/o/images%2Fremove-btn.png?alt=media&token=1d8286da-7b6b-4af3-85bc-1ecb089339f9\" alt=\"remove_btn\" width=\"32px\">\r\n  </div>\r\n  `;\r\n\r\n  cartResume.appendChild(productCart);\r\n\r\n  productCart.addEventListener(\"click\", e => {\r\n    e.preventDefault();\r\n    if(e.target.tagName === \"IMG\"){\r\n      removeProducts(product.id);\r\n    }\r\n  });\r\n};\r\n\r\n//----------Checkout------------\r\nconst deleteCart = async () => {\r\n  try {\r\n    await deleteDoc(doc(db, \"cart\", userLogged.uid));\r\n    loadCart([]);\r\n    console.log(\"actulizando...\");\r\n  } catch(e) {\r\n    console.log(e);\r\n  }\r\n  window.location.reload();\r\n}\r\n\r\nconst createOrder = async (userData) => {\r\n  try {\r\n    const order = await addDoc(collection(db, \"orders\"),{\r\n      ...userData, \r\n      products: cart,\r\n      total\r\n    });\r\n    alert(`Gracias ${userData.name}, tu orden ${order.id} va en camino`);\r\n\r\n    deleteCart();\r\n  }catch(e){\r\n    console.log(e);\r\n  }\r\n};\r\n\r\nbtnCheckout.addEventListener(\"click\", e => {\r\n  e.preventDefault();\r\n  const name = checkoutInfo.name.value;\r\n  const id = checkoutInfo.id.value;\r\n  const adress = checkoutInfo.adress.value;\r\n\r\n  \r\n  const userData = {\r\n    name, \r\n    id,\r\n    adress\r\n  }\r\n\r\n  if(cart.length){\r\n    if(name && id  && adress) {\r\n      createOrder(userData);\r\n    } else {\r\n      alert(\"Completa todos los campos\");\r\n    }\r\n  } else{\r\n    alert(\"AÃºn no tienes productos en el carrito :(\")\r\n  }\r\n});\r\n\r\nonAuthStateChanged(auth, async (user) => {\r\n    if (user) {\r\n     \r\n      userLogged = user;\r\n      cart = await getFirebaseCart(db, userLogged.uid);\r\n\r\n    } else {\r\n        cart = getMyCart();\r\n     \r\n    }\r\n    loadCart(cart);\r\n\r\n  });"],"names":["$ijjug","parcelRequire","$4400fb85618189e4$var$total","$4400fb85618189e4$var$cart","$4400fb85618189e4$var$cartResume","document","getElementById","$4400fb85618189e4$var$cartPriceTotal","$4400fb85618189e4$var$checkoutInfo","$4400fb85618189e4$var$btnCheckout","$4400fb85618189e4$var$loadCart","cart","forEach","product","productCart","createElement","className","innerHTML","images","name","color","size","$jVR3t","currencyFormat","price","appendChild","addEventListener","e","preventDefault","target","tagName","productId","newCart","filter","id","userLogged","$lBmPO","createFirebaseCart","db","uid","$jOLmm","addProductToCart","$4400fb85618189e4$var$removeProducts","$4400fb85618189e4$var$renderProducts","parseInt","cartTotal","console","log","$4400fb85618189e4$var$createOrder","async","userData","order","$etBjH","addDoc","collection","products","total","alert","deleteDoc","doc","window","location","reload","$4400fb85618189e4$var$deleteCart","value","adress"],"version":3,"file":"myCart.4c94c454.js.map"}